# jqGrid 编辑 之 单元格编辑

[原文](http://www.trirand.com/jqgridwiki/doku.php?id=wiki:cell_editing)

单元格编辑，嗯……就是单元格编辑。

jqGrid 的单元格编辑提供键盘导航和编辑单独的单元格的功能：

* 当单击了不可编辑的单元格时，单元格被选中，我们可以使用键盘上的“↑”、“→”、“↓”、“←”键来移动光标。

* 移到可编辑的单元格上时，按 Enter 键即可进入编辑状态，再次 Enter 或者按 Tab 键 或者点击其他单元格就会保存更改。

    按 Esc 键撤销编辑。编辑状态时，方向键只能在单元格内移动。

* 如果单击了可以编辑的单元格，直接进入编辑模式。

* 如果单元格有类名 (class) "not-editable-cell" ，则不可编辑，这个的优先级高于 colModal 中的 editable 。

## 相关属性

<table>
    <tr>
        <th>属性名</th>
        <th>类型</th>
        <th>描述</th>
        <th>默认值</th>
    </tr>
    <tr>
        <td>cellEdit</td>
        <td>布尔值</td>
        <td>是否启用单元格编辑。<br />如果设置为 true ，启用，同时事件 onSelectRow 不可用，tr 上的 hover 效果（鼠标行高亮）禁用。</td>
        <td>false</td>
    </tr>
    <tr> 
        <td>cellsubmit</td>
        <td>字符串</td>
        <td>
            单元格的内容保存到何处。<br />
            两个值可用：<br />
            <strong>remote</strong>： <br />
            保存时，立刻通过 ajax 的方式将数据发送 cellurl 指定的服务器端。<br />
            发送的数据包括所在行的 id ，以及单元格的内容。<br />
            <strong>clientArray：</strong><br />
            不会发送请求，只保存在页面中。<br />
            可以通过 getChangedCells 来获取修改的单元格，或者监听事件。
        </td>
        <td>remote</td>
    </tr>
    <tr>
        <td>cellurl</td>
        <td>字符串</td>
        <td>发送请求的链接。</td>
        <td>null</td>
    </tr>
    <tr>
        <td>ajaxCellOptions</td>
        <td>对象</td>
        <td>设置 $.ajax 的相关参数。注意，如果你设置了这个属性，可能覆盖任何默认值。不了解的话，慎用。</td>
        <td>空对象</td>
    </tr>
</table>

#### 实例

```js
// cellsubmit 为 remote ， cellurl 就有必要了
{
    cellEdit : true,
    cellsubmit : "remote",
    cellurl : "/url/to/handling/the/changed/cell/value"
}
```

```js
// cellsubmit 为 clientArray ，则 cellurl 没有必要
{
    cellEdit : true,
    cellsubmit : "clientArray"
}
```


## 相关事件

下面这些事件可能有的参数：

* rowid： 行 id 值

* cellname： 单元格的 name ，来自 colModel 中的 name

* value： 单元格的内容

* iRow： 行索引，务必不要和 rowid 混淆

* iCol： 列索引

<table>
    <tr>
        <th>事件名</th>
        <th>参数</th>
        <th>描述</th>
    </tr>
    <tr>
        <td></td>
        <td></td>
        <td></td>
    </tr>
</table>


## 相关方法

<table>
    <tr>
        <th>方法名</th>
        <th>参数</th>
        <th>描述</th>
    </tr>
</table>


## 从只读到可编辑的过程

单元格进入可编辑状态、input 元素被创建这一过程遵从如下规则：

* 可编辑元素（通常为文本框）的 id 值构成：
    
        单元格所在行的索引 + "_" + 来自 colModel 中的 name

    假如编辑的单元格在第 20 行， colModel 中的 name 为 myname ，那么 id 为 "20_myname" 。

* 可编辑元素（通常为文本框）的 name 就是 colModel 中的 name


## 传递到服务器的数据

一般都是传递一个键值对({})到服务器：

* name: value 键值对，文本框中很常见，不多说

* id: rowid ，所在行的 id 也传到后台

* 事件 beforeSubmitCell 的返回值如果非空，一并传递到后台

Example:

    假如文本框的 name 是 myname ，值为 2222
    所在行 id 为 2572
    事件 beforeSubmitCell 返回值如下：
    {
        a: "a",
        b: "b"
    }

    那么传递到后台的数据就是：
    {
        myname: 2222,
        id: 2572,
        a: "a",
        b: "b"
    }



